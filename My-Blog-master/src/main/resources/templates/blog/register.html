<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>能猫的个人博客 | 注 册</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" th:href="@{/admin/dist/img/favicon.png}"/>
    <!-- Font Awesome -->
    <link rel="stylesheet" th:href="@{/admin/dist/css/font-awesome.min.css}">
    <!-- Ionicons -->
    <link rel="stylesheet" th:href="@{/admin/dist/css/ionicons.min.css}">
    <!-- Theme style -->
    <link rel="stylesheet" th:href="@{/admin/dist/css/adminlte.min.css}">
    <style>
        canvas {
            display: block;
            vertical-align: bottom;
        }
        #particles {
            background-color: #F7FAFC;
            position: absolute;
            top: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
    </style>
</head>
<body class="hold-transition login-page">
<div id="particles">
</div>
<div class="login-box">
    <div class="login-logo" style="color: #007bff;">
        <h1>能猫的个人博客 | 注 册</h1>
    </div>
    <!-- /.login-logo -->
    <div class="card">
        <div class="card-body login-card-body">
            <p class="login-box-msg">如有什么疑问，请联系站长  QQ:995829376</p>

            <form th:action="@{/blog/register}" method="post">
                <div th:if="${not #strings.isEmpty(session.errorMsg)}" class="form-group">
                    <div class="alert alert-danger" th:text="${session.errorMsg}"></div>
                </div>

                <div class="form-group has-feedback">
                    <span class="fa fa-user form-control-feedback"></span>
                    <input type="text" id="mobileNo" name="mobileNo" class="form-control" placeholder="请输入手机号"
                           required="true">
                    <div class="col-8">
                        <button id="postButton" class="btn btn-primary btn-block btn-flat">发送验证码
                        </button>
                    </div>
                </div>

                <div th:if="${not #strings.isEmpty(session.errorMsg)}" class="form-group"></div>
                <div class="row">
                    <div class="col-6">
                        <span class="fa fa-flash form-control-feedback"></span>
                        <input type="text" class="form-control"   id="verifyCode" name="verifyCode" placeholder="请输入验证码" required="true">
                    </div>
                </div>

                <div class="form-group has-feedback"></div>
                <div class="row">
                    <div class="col-8">
                    </div>
                    <div class="col-4">
                        <button type="submit" class="btn btn-primary btn-block btn-flat">注册
                        </button>
                    </div>
                </div>
            </form>
        </div>
        <!-- /.login-card-body -->
    </div>
</div>

<script>
    var wait = 300;
    document.getElementById("postButton").onclick = function() {
        time(this);
    }
    function time(o) {
        if (wait == 0) {
            o.removeAttribute("disabled");
            o.innerHTML = "重新发送验证码";
            wait = 300;
        } else {
            o.setAttribute("disabled", true);
            o.innerHTML = wait + "秒后可以重新发送";
            wait--;
            setTimeout(function() {
                time(o)
            }, 1000)
        }
    }






    // 获取按钮元素和响应元素
    var postButton = document.getElementById("postButton");
    // 获取输入元素和按钮
    var mobileNo = document.getElementById("mobileNo");


    // // 添加输入事件处理程序
    // mobileNo.addEventListener("input", function () {
    //     // 如果输入框中有文本内容，启用按钮，否则禁用按钮
    //     if (mobileNo.value.trim() !== "" && mobileNo.value.length() == 11) {
    //         postButton.removeAttribute("disabled");
    //     } else {
    //         postButton.setAttribute("disabled", "disabled");
    //     }
    // });


    var data={};

    // 添加点击事件处理程序来获取输入值
    postButton.addEventListener("click", function (event) {

        // 获取输入元素的值并将其分配给数据对象的属性
        data.mobileNo = mobileNo.value;

        // 创建一个新的XMLHttpRequest对象
        var xhr = new XMLHttpRequest();
        // 配置请求，使用POST方法发送数据
        xhr.open("POST", "/blog/sendSmsCode", true);
        // 设置请求标头，告诉服务器请求的内容类型（通常是JSON）
        xhr.setRequestHeader("Content-Type", "application/json");

        alert("短信已发送至手机:"+ data.mobileNo+" 请注意查收!");

        // 将数据对象转换为JSON字符串
        var jsonData = JSON.stringify(data);

        // 定义一个回调函数来处理响应
        xhr.onreadystatechange = function () {
            // 检查请求是否成功完成（状态码 4 表示请求已完成）
            if (xhr.readyState === 4) {
                // 检查HTTP状态码（200表示成功）
                if (xhr.status === 200) {
                    // 解析响应的数据
                    var response = JSON.parse(xhr.responseText);

                } else {

                }
            }
        };
        // 发送POST请求，并将JSON数据作为请求体发送
        xhr.send(jsonData);
    });
</script>
<!-- /.login-box -->

<!-- jQuery -->
<script th:src="@{/admin/plugins/jquery/jquery.min.js}"></script>
<!-- Bootstrap 4 -->
<script th:src="@{/admin/plugins/bootstrap/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/admin/dist/js/plugins/particles.js}"></script>
<script th:src="@{/admin/dist/js/plugins/login-bg-particles.js}"></script>
</body>
</html>